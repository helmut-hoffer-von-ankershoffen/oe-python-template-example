# Contributing

Thank you for considering contributing to OE Python Template Example!


## Setup

Install or update tools required for development:

```shell
# Install Homebrew, uv package manager, copier and further dev tools
curl -LsSf https://raw.githubusercontent.com/helmut-hoffer-von-ankershoffen/oe-python-template/HEAD/install.sh | sh
```

[Create a fork](https://github.com/helmut-hoffer-von-ankershoffen/oe-python-template-example/fork) and clone your fork using ```git clone URL_OF_YOUR_CLONE```. Then change into the directory of your local OE Python Template Example repository with ```cd oe-python-template-example```.

If you are one of the committers of https://github.com/helmut-hoffer-von-ankershoffen/oe-python-template-example you can directly clone via ```git clone git@github.com:helmut-hoffer-von-ankershoffen/oe-python-template-example.git``` and ```cd oe-python-template-example```.


## Directory Layout

```
├── Makefile               # Central entrypoint for build, test, release and deploy
├── noxfile.py             # Noxfile for running tests in multiple python environments and other tasks
├── .pre-commit-config.yaml # Definition of hooks run on commits
├── .github/               # GitHub specific files
│   ├── workflows/         # GitHub Actions workflows
│   ├── prompts/           # Custom prompots for GitHub Copilot
│   └── copilot-instructions.md # Insructions for GitHub Copilot
├── .vscode/               # Recommended VSCode settings and extensions
├── .env                   # Environment variables, on .gitignore
├── .env.example           # Example environment variables
src/oe_python_template_example/  # Source code
├── __init__.py          # Package initialization
├── constants.py         # Constants used throughout the app
├── settings.py          # Settings loaded from environment and .env
├── models.py            # Models and data structures
├── service.py           # Service exposed for use as shared library
├── cli.py               # CLI enabling to interact with service from terminal
└── api.py               # API exposing service as web service
tests/                   # Unit and E2E tests
├── cli_tests.py         # Verifies the CLI functionality
├── api_tests.py         # Verifies the API functionality
└── fixtures/            # Fixtures and mock data
docs/                    # Documentation
├── partials/*.md        # Partials to compile README.md,  _main partial included in HTML and PDF documentation
├── ../README.md         # Compiled README.md shown on GitHub
├── source/*.rst         # reStructuredText files used to generate HTML and PDF documentation
├── ../*.md              # Markdown files shown on GitHub and imported by .rst files
├── source/conf.py       # Sphinx configuration used to generate HTML and PDF documentation
├── build/html/*         # Generated HTML documentation as multiple pages
├── build/singlehtml/index.html # HTML documentation as a single page
└── build/latex/oe-python-template-example.pdf # PDF manual - generate with make docs pdf
examples/                # Example code demonstrating use of the project
├── streamlit.py         # Streamlit App, deployed in Streamlit Community Cloud
├── notebook.py          # Marimo notebook
├── notebook.ipynb       # Jupyter notebook
└── script.py            # Minimal script
reports/                 # Compliance reports for auditing
├── junit.xml            # Report of test executions run with pytest
├── mypy_junit.xml       # Report of static typing validation run with mypy
├── coverage.xml         # Test coverage in XML format generated by pytest-cov
├── coverage_html        # Report of test coverage in HTML format
├── licenses.csv         # List of dependencies and their license types
├── licenses.json        # .json file with dependencies their license types
├── licenses_grouped.json  # .json file with dependencies grouped by license type
├── vulnerabilities.json # .json file with vulnerabilities detected in dependencies by pip-audit
└── sbom.json            # Software Bill of Materials in OWASP CycloneDX format
```


## Build, Run and Release

### Setup project specific development environment

```shell
make setup
```

Don't forget to configure your `.env` file with the required environment variables.

Notes:
1. .env.example is provided as a template, use ```cp .env.example .env``` and edit ```.env``` to create your environment.
2. .env is excluded from version control, so feel free to add secret values.

### Build

```shell
make        # Runs primary build steps, i.e. formatting, linting, testing, building HTML docs and distribution, auditing
make help   # Shows help with additional build targets, e.g. to build PDF documentation, bump the version to release etc.
```

Notes:
1. Primary build steps defined in `noxfile.py`.
2. Distribution dumped into ```dist/```
3. Documentation dumped into ```docs/build/html/``` and ```docs/build/latex/```
4. Audit reports dumped into ```reports/```

### Run the CLI

```shell
uv run oe-python-template-example # shows help
```

### Commit and Push your changes

```shell
git add .
git commit -m "feat(user): added new api endpoint to offboard user"
git push
```

Notes:
1. [pre-commit hooks](https://pre-commit.com/) will run automatically on commit to ensure code quality.
2. We use the conventional commits format - see the [code style guide](CODE_STYLE.md) for the mandatory commit message format.

### Publish Release

```shell
make bump   # Patch release
make minor  # Patch release
make major  # Patch release
make x.y.z  # Targeted release
```

Notes:
1. Changelog generated automatically
2. Publishes to PyPi, Docker Registries, Read The Docs, Streamlit and Auditing services


## Advanced usage

### Running GitHub CI Workflow locally

```shell
make act
```

Notes:
1. Workflow defined in `.github/workflows/*.yml`
2. test-and-report.yml calls all build steps defined in noxfile.py

### Docker

Build and run the Docker image with plain Docker

```shell
# Build from Dockerimage
make docker build
# Run the CLI
docker run --env THE_VAR=THE_VALUE oe-python-template-example --help
```

Build and run the Docker image with docker compose:

```shell
echo "Building the Docker image with docker compose and running CLI..."
docker compose run --build oe-python-template-example --help
echo "Building the Docker image with docker compose and running API container as a daemon ..."
docker compose up --build -d
echo "Waiting for the API server to start..."
sleep 5
echo "Checking health of v1 API ..."
curl http://127.0.0.1:8000/api/v1/healthz
echo ""
echo "Saying hello world with v1 API ..."
curl http://127.0.0.1:8000/api/v1/hello-world
echo ""
echo "Swagger docs of v1 API ..."
curl http://127.0.0.1:8000/api/v1/docs
echo ""
echo "Checking health of v2 API ..."
curl http://127.0.0.1:8000/api/v2/healthz
echo ""
echo "Saying hello world with v1 API ..."
curl http://127.0.0.1:8000/api/v2/hello-world
echo ""
echo "Swagger docs of v2 API ..."
curl http://127.0.0.1:8000/api/v2/docs
echo ""
echo "Shutting down the API container ..."
docker compose down
```

### Pinning GitHub Actions

```shell
pinact run  # See https://dev.to/suzukishunsuke/pin-github-actions-to-a-full-length-commit-sha-for-security-2n7p
```


## Update from Template

Update project to latest version of [oe-python-template](https://github.com/helmut-hoffer-von-ankershoffen/oe-python-template) template.

```shell
make update_from_template
```


## Pull Request Guidelines

1. Before starting to write code read the [code style](CODE_STYLE.md) document for mandatory coding style requirements.
2. **Pre-Commit Hooks:** We use pre-commit hooks to ensure code quality. Please install the pre-commit hooks by running `uv run pre-commit install`. This ensure all tests, linting etc. pass locally before you can commit.
3. **Squash Commits:** Before submitting a pull request, please squash your commits into a single commit.
4. **Signed Commits:** Use [signed commits](https://docs.github.com/en/authentication/managing-commit-signature-verification/signing-commits).
5. **Branch Naming:** Use descriptive branch names like `feature/your-feature` or `fix/issue-number`.
6. **Testing:** Ensure new features have appropriate test coverage.
7. **Documentation:** Update documentation to reflect any changes or new features.
